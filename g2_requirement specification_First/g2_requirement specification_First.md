# 要求仕様書 ver.2
作成日：2025/05/14 
版数：2
   -   第1版：5月8日
   -   第2版：5月14日
作成者：小野田、田中、渡辺

## 1. 概要

本システムは、大学生協の座席予約を行うためのWebアプリケーションと、その管理機能で構成される。ユーザーは、Web（ブラウザ）上で座席の予約・変更・キャンセルを行い、大学生協の入口でチェックインをすることで座席の確保を行うことが可能である。（予約をしなくてもチェックインの際に、その場で座席の確保ができる仕組みも取り入れる。）なお、管理者は、予約状況の管理・座席の管理・システムの設定等を行うことができる。

### システム利用可能時間
-   大生の営業時間以外もホールは解放されている。
-   その時間も含めた座席管理システムにしないと、営業時間になったときの座席管理が難しくなる。（間違えて継続利用する可能性等）
-   ホール開放時間に合わせたシステムを構築したほうが実用性は高いかもしれない。
-   決定：ホールの開放時間

### 利用者
-   **予約ユーザー**
    -   Web上で座席の予約を行ったユーザー
-   **予約していないユーザー**
    -   Web上で座席の予約をせず、チェックイン場所で座席の確保をするユーザー
-   **管理者**
    -   座席予約システムの運用・管理を行う

### システムの基本構成
-   予約用ユーザーサイト（Webアプリケーション…スマートフォン・PC対応）
    -   スマートフォン・PCのそれぞれに最適なUIを提供  
-   チェックイン画面（PCかつ専用端末を想定）
    -   管理者側が意図しない操作を、ユーザーがしない仕組み
        -   タッチパネル操作は難しいことから、以下以外の操作をできないようにする。
            -   マウスによる画面操作
            -   インカメラによるQRコードの読み取り
    -   Windowsアプリケーションを想定（可能であれば、Webアプリケーションでも可）
-   管理者サイト（Webアプリケーション…PC）
-   データベース
-   サーバー（メール送信不可、学内サーバーを利用）

### データベース一覧（メモ）
-   ユーザー管理ID・パスワード用データベース
    -   必要なデータ
        -   ユーザー番号（UUID）
        -   認証方法：通常認証かGoogleアカウント認証か
        -   ユーザーID：ユーザーが設定
        -   ユーザー用パスワード：ユーザーが設定
        -   Googleアカウント認証から返ってくる文字列
        -   秘密の質問（通常認証のみ）
        -   秘密の質問の答え（通常認証のみ）
        -   ステータス：ログインの有無
-   当日予約分のユーザー情報・予約情報のデータベース
    -   必要なデータ
        -   予約したユーザーのSSID
        -   予約の整理番号
        -   ID（キャンセル時用）
        -   予約した時間
        -   予約した座席（複数人の場合も考慮）
        -   予約ステータス（チェックインの有無）
    -   ここを削除した場合には、該当する予約時間の座席の情報をすべて削除
　  -   チェックインした場合には、その旨を座席管理用のデータベースに送信
　　-   予約時間から10分経過後に、データを削除する情報を送信
-   当日の時間ごとの座席管理データベース
    -   10分ごとに当日の時間を管理
    -   時間を選択することで、その10分間の空席状況を表示
-   時間ごとの座席状況を管理するデータベース
    -   座席ごとのステータス：空席・予約・チェックイン済み
    -   映画館の座席MAPのイメージ
-   管理者ID・パスワード用データベース
    -   必要なデータ
        -   管理者用ID
        -   管理者用パスワード       

### 座席の予約・管理データの収集について（検討）
-   当日から1週間分のデータベースを保管
-   規定時間にその日の座席の状況・キャンセル状況用のデータベースをそれぞれ用意しデータを収集（アップデート機能のため
-   当日以外のデータを集めない

### テーマカラー
-   青色系？赤色系？緑色系？…
-   暖色系？

### 座席管理の仕組み
-   指定された時間の該当するデータベースから空席情報を取得（該当する時間すべての時間で開いている席）
    -   満席の場合には、満席と表示
    -   該当時間の一部時間のみ空いている場合は、別の色で時間とともにその旨を表示
-   空席情報をもとに、映画館のような大生全体の座席MAPに空席の状況を可視化
-   希望の座席を見つけた場合には、座席のボタンを押す
    -   押した時点でデータを仮予約データを送信
    -   取れた場合にはその旨を、埋まっている場合には埋まっている旨の情報を取得し、画面のポップアップ等に表示
    -   外した時点でデータを削除する情報を送信
-   確定ボタンを押して予約を確定
    -   2分以上確定ボタンが押されないときには、仮予約をキャンセルする情報を送信…検討

## 2. 用語

-   **予約ユーザー**
    -   システムを利用して座席を予約するユーザー。
-   **予約していないユーザー**
    -  　システムで座席を予約していないユーザー。チェックイン時に手続きを行う。
-   **認証**
    -   ユーザー新規登録の際、IDが不正な文字列でないかチェックした上で、自動でデータベースに追加
    -   認証方法
        -   通常認証：ユーザーIDとパスワードを入力
        -   Googleアカウント認証    
    -   データベース内で、同一のIDがある場合には、新規登録不可（通常認証とGoogleアカウント認証では重複可能）
    -   **ユーザー番号**    
        -   UUID バージョン4を使用。
        -   新規発行時に自動で生成
    -   **ユーザーID**
        -   6文字以上30文字以下。
    -   **パスワード**
        -   英数の大文字・小文字のみ。
        -   8文字以上64文字以下。
        -   ID、秘密の質問により再設定可能。
    -   **Googleアカウントを利用した認証も可能**
-   **パスワード再設定**
    -   **秘密の質問**
        -   ユーザーは、自分で”質問”とその”回答”を1つずつ設定
        -   ロックアウトを使用。例：通算10回失敗でアカウントロック
        -   ログイン済みであれば、再設定可能
-   **QRコード**
    -   チェックイン時に使用（大生入口でQRコードをスキャンしチェックイン）    
    -   **読み取り用PC設置場所**
        -   大学生協の入口など、利用者がアクセスしやすい場所に設置
    -   予約番号、日付、ユーザーのUUID等を含む二次元コード（悪用を防ぐため）
    -   QR code API等を使用
    -   予約番号をもとに生成
-   **予約情報**   
    -   予約に関する詳細データ
        -   予約番号
        -   人数（1～8人）
        -   予約日時
        -   滞在予定時間
        -   座席指定：映画館のような座席全体のMAPから選択
    -   Webサイトはセレクトタグ、チェックイン機はタッチ式（暗証番号の入力画面のようなもの）を検討
-   **予約番号**
    -   各予約を識別するためのID（UUID）
    -   予約順に番号を決定（当日分の予約だけなら、ユーザーIDで管理可能だが、念のため使用）
-   **座席利用用整理番号**
    -   各座席の利用者を識別するためのID（UUID）
    -   チェックイン順に番号を決定
-   **滞在予定時間**
    -   ユーザーが座席を利用する予定の時間を予約やチェックインの際に収集。
    -   管理者機能で、ここの文言を変更可能にする
        -   データベースへの書き込み方法も考慮
        -   ユーザーにはセレクトタグ・ボタンで表示
    -   例
        -   「すぐ食べ終わる (20分)」
        -   「ゆっくり食べる (40分)」
        -   「長時間滞在予定 (1h)」
        -    それ以上の時間も、選択可能
-   **チェックイン**
    -   大生の入口でユーザーが予約した座席またはその場で確保した座席の利用開始の手続きを行う
-   **データベース（予定）**
    -   ユーザー管理ID・パスワード用データベース
    -   当日予約分のユーザー情報と予約情報用のデータベース
    -   当日の時間ごとの座席管理データベース
    -   時間ごとの座席状況を管理するデータベース
    -   管理者ID・パスワード用データベース
-   **管理者ID・パスワード**
    -   管理者一人一人に発行
    -   データベース作成時に、管理用・非常用等いくつかのID・パスワードを発行
        -   以降は、その既に追加したIDでログインした管理者サイト内で認証
        -   ID：10文字以上30文字以下
        -   パスワード：12文字以上64文字以下
    -   Gmail APIが使用可能なら、多様素認証を導入   
-   **予約用ユーザーサイト**
    -   ユーザーが座席の予約、変更、キャンセル登録等を行うためのWebサイト
-   **チェックイン画面/サイト**
    -   ユーザーが大学生協の入口でチェックイン手続きを行うための画面
-   **管理者サイト**
    -   管理者がシステムの管理・運用を行うためのWebサイト
-   **仮予約**
    -   オーバーブッキングを避けるため、ユーザーが座席を選択した時点で一時的（2分）に座席を確保する状態
-   **UUID**
    -   128ビット（＝16バイト）の値で、対象を一意に識別する仕組み
    -   今回は、すべてバージョン4を使用

## 3. 機能要件

### ユーザー向け機能

-   **新規ユーザー登録**
    -   ユーザーIDとパスワード、秘密の質問を入力し、データベースに追加
    -   不正なID・パスワードではないことを確認し、自動で追加
-   **ログイン機能**
    -   ユーザーIDとパスワードを入れてログイン
    -   予約するユーザーを識別可能
    -   画面詳細
        -    ログイン用ID・パスワード入力欄
        -    Google認証
        -    新規登録→新規登録ページへ
    -    ※認証用の変数を用意（どちらの認証方式にも対応するため）   
-   **ログアウト機能**
    -   データベースをログアウトにする
    -   画面をログイン画面に戻す
-   **パスワード再設定機能**
    -   ユーザーIDと秘密の質問により、ユーザーIDに紐づいたパスワードが更新される機能。
-   **秘密の質問再設定機能**
    -   ユーザーIDとパスワードにより、ユーザーIDに紐づいた秘密の質問が更新される機能。
-   **通知機能**
    -   新規ユーザーIDやパスワードの登録、予約情報等をWebサイト内の通知（通知一覧を作る）できるようにする  
-   **新規予約機能**
    -   **予約情報入力機能**
        -   利用人数（1～8人）
        -   希望時間（10分ごと）
        -   滞在予定時間（例：「すぐ食べ終わる (20分)」「ゆっくり食べる (40分)」「長時間滞在予定 (1h以上)」）
        -   座席指定
            -   食堂の座席をマップ表示→選択を想定
    -   **入力情報確認機能**
        -   入力した予約情報を確認し、必要に応じて修正のために前画面に戻れる機能（戻った際、入力済み情報は保持される）
    -   **空席確認機能**
        -   予約情報を入力した際の情報（予約人数・予約時間・滞在予定時間・希望する座席）に基づいて、データベースを参照して予約可能な空き状況を確認
        -   空き状況を表示し、座席を選択した時点で仮予約（人数以上の座席選択は不可）
            -   2分以上、仮予約の状態が続いた場合は、仮予約をキャンセル
            -   仮予約までの間に埋まった場合は、その旨をポップアップで表示し、データベースを再度参照し、新たな座席の空き状況を表示
    -   **予約確定機能**
        -   確定ボタンを押した時点で、予約を確定
    -   **QRコード・予約情報表示機能**
        -   予約済みの場合には、新規予約の部分にQRコード・予約情報を表示
        -   新たな新規予約はできないようにする（利用が終わった段階で、再度予約可能）
-   **予約変更機能**
    -   **既存の予約の呼び出し機能**
        -   ログイン情報をもとに、既存の予約情報を呼び出し   
    -   **予約内容変更機能**
        -   呼び出した予約情報を自動で出力し、変更した内容をデータベースで書き替え
    -   **変更内容確認・確定機能**
        -   新規予約機能の入力情報確認機能と同様
    -   **変更後情報送信機能**
        -   変更が確定した場合、新たな予約情報とQRコードに更新
-   **予約キャンセル機能**
    -   **既存の予約の呼び出し機能**
        -   ログイン情報をもとに、既存の予約情報を呼び出し   
    -   **キャンセル実行機能**
        -   予約のキャンセルをするかの確認画面を経て、予約情報やQRコードを消し、データベース内のデータを削除

### チェックイン機能（チェックイン画面）

-   **予約有無選択機能**：ユーザーが「予約している」か「予約していない」かを選択する。
-   **予約済みユーザー向けチェックイン機能**
    -   **QRコード読み取り機能**
        -   事前にログインした画面に表示された予約用QRコードを、チェックイン機（PC）のインカメラでスキャン
        -   読み取りのUIは、ユニクロの会員証読み取り画面
        -   読み取りが難しい場合には、番号入力で対応する必要あり：IDとパスワードの入力により対応もしくは、管理者が手動でチェックイン
    -   **チェックイン確定機能**
    -   **エラー表示機能**
        -   QRコードを読み込めなかった際に表示
-   **予約なしユーザー向けチェックイン機能**
    -   **予約情報入力機能**
        -   利用人数（1～8人）
        -   希望時間（10分ごと）
        -   滞在予定時間（例：「すぐ食べ終わる (20分)」「ゆっくり食べる (40分)」「長時間滞在予定 (1h以上)」）
        -   座席指定
            -   食堂の座席をマップ表示→選択を想定
    -   **入力情報確認機能**
        -   入力した予約情報を確認し、必要に応じて修正のために前画面に戻れる機能
        -   （戻った際、入力済み情報は保持される）
    -   **空席確認機能**
        -   入力された条件に基づいて、データベースを参照して予約可能な空き状況を確認
        -   空き状況を表示し、座席を選択した時点で仮予約（人数以上の座席選択は不可）
            -   1分以上、仮予約の状態が続いた場合は、仮予約をキャンセル
            -   仮予約までの間に埋まった場合は、その旨をポップアップで表示し、データベースを再度参照し、新たな座席の空き状況を表示
    -   **チェックイン確定機能**
        -   確定ボタンを押した時点で、チェックインを確定
-   **入力制限機能**: 管理者側の意図した情報以外を入力できないような画面設計
-   チェックイン後（＝QRコードで認証もしくは情報を確定後）、すぐ（1秒程度）にもとの予約しているかを選択する画面に戻る

### 管理者向け機能

-   **ログイン機能**
    -   **ID・パスワード認証機能**
    -   **個別ID・パスワード発行機能**
        -   同時ログインを行うために、管理者ごとに個別のIDとパスワードを発行
-   **予約管理機能**
    -   **予約情報一覧表示機能**
        -   予約されている情報・座席情報の一覧を確認
        -   ユーザーUUID・ID・予約番号のいずれかで検索可能
        -   **強制予約取消機能**
            -   管理者が特定の予約を強制的にキャンセルする機能
            -   キャンセル時には利用者に自動でメール通知（※サーバーがメール送信不可のため、この機能は再検討が必要）
    -   **座席混雑マップ表示機能**
        -   日時を選択すると、10分ごとの座席の混雑状況をマップ形式で表示
    -   **予約受付強制停止機能**
        -   システム全体または特定時間帯の新規予約受付を一時的に停止する機能
        -   停止中はユーザーサイトにポップアップ等で表示する。
-   **QRコード発行システム連携**
    -   予約情報に基づいてチェックイン用QRコードを生成
        -   自動で発行・更新する機能（QR code API等）
-   **システム設定機能**
    -   予約に関する各種パラメータ（予約可能期間、一予約あたりの最大人数等）を設定
    -   滞在予定時間の変更（データベースへの書き込みを考慮）
        -   滞在予定時間：例…「すぐ食べ終わる (20分)」「ゆっくり食べる (40分)」「長時間滞在予定 (1h以上)」の内容を変更可能
        -   文言の数と、該当時間（データベースへの入力も考慮）   

## 4. 非機能要件


### 信頼性・正確性
-   オーバーブッキング防止
    -   座席選択時に仮予約（一定時間(＝2分）を確保）を行い、他のユーザーとの同時予約による重複を防ぐ
    -   新規予約のボタンを押した段階で整理番号を発行し、データベースに書き込む順番を決定（トランザクション管理？）
        -   整理番号は発行するが、書き込む順番を決めるのには用いない（予約していないユーザーの座席管理を考慮）
            -   座席の空席状況は、新規予約（あるいは変更）を押したタイミングでの座席管理情報を反映
            -   書き込みに関しては、仮予約として情報をデータベースに送信する
            -   座席が取れた・取れなかったの旨をデータとして取得…ポップアップに表示

### セキュリティ
-   機密性について
    -   管理者サイトへのアクセスは一意のIDとパスワードによる認証を必須とし、権限のないユーザーのアクセスを防止すること
    -   全てのWebページにおいてHTTPSを使用して通信データを暗号化すること
    -   QRコードの生成については、当日より前の日に利用した同じ予約番号の人が使えないようにすること
        -   日付情報やUUIDを用いる等のデータベースとの連携が必要   
- 　完全性について
    -   ユーザーとシステム間で送受信されるデータが、第三者に改善されないようHTTPSを使用することで通信データを暗号化し、データの完全性を保証すること
    -   入力値検証をサーバーサイドでも行い、不正なスクリプトの入力を禁止
    -   予約情報の入力には、SELECTタグ等のユーザーが直接入力できないようにする対策を実施
        -   ユーザーのID・パスワード、管理者用のID・パスワード以外には、ユーザーが直接入力できないようにする
    -   ID・パスワードの形式が正しいか、不正な文字列でないかチェックをすること
        -   文字数オーバー、すでに登録されている等    
    -   禁止する特定の文字列（script・データベースの追加や削除のコードなど）を検出し、拒否する方式を取ること
    -   30（ID）、64文字（パスワード）以上の極端に長い文字列を禁止すること
-   可用性について
    -   DDoS攻撃への対策
        -   Firewallの設定をすること
　	    -   攻撃元のIPアドレスを特定できた際に、ブロックリストに追加すること
            （実際には、学内Wi-Fi等は、たくさんのユーザーが利用することを考慮）　
        -   大量のアクセスによるサービス停止を防ぐための対策を検討（IPアドレス制限、リクエストレート制限等）

### ユーザビリティ
-   アイコンと文字を効果的に使用し、ユーザーが迷わず操作
    -   ナビゲーションバー等
-   入力情報の保持
    -   画面遷移時には、既に入力された情報を保持し、再入力の手間を省く
    -   Cookieを使用：ユーザビリティを考慮して、Cookieを使用しますかはあまり出したくない
-   操作制限
    -   チェックイン画面で管理者側の意図しない情報や操作を行えないように、機能を制限
-   多言語対応
    -   日本語および英語に対応（予約ユーザーサイト・チェックイン画面のみ）

### 性能
-   大量アクセス対応
    -   多数の同時アクセスに対応
-   以下のデータベースは、当日の00:00に新たなものを作成
    -   当日予約分のユーザー情報と予約情報用のデータベース
    -   当日の時間ごとの座席管理データベース
    -   時間ごとの座席状況を管理するデータベース

### 運用・保守性
-   管理者複数ログイン対応
    -   複数の管理者が同時に管理者サイトにログインして作業可能
-   QRコード自動化
    -   予約確定時や変更時に、QRコードを自動で生成し出力
    -   QR code APIを使用

### 検討
-   パスワードのハッシュ化・ソルト使用？
-   一定時間（10分）操作がない場合には、自動的にログアウト
-   cookieの設定方法（できれば最小限に抑えたい）
-   セッションIDを乱数で生成
-   10回ログインを失敗時には、アカウントを自動削除（ブルートフォース攻撃対策）
-   ファイアウォール：Web Application Firewall (WAF)
-   サーバーメンテナンス時間の設定（20:00～翌6:00）
-   将来的な拡張スペースの確保（メニューバー・混雑状況可視化グラフ等）
-   チェックイン端末のCPU・メモリ使用率等が、異常な値を示したときには管理者に通知
-   各種障害時の対応
    -   座席が同じタイミングで仮予約
        -   UUIDをもとに、ランダム関数を用いて、優先度を決定
    -   予約処理のエラー
        -   データベースからの情報に基づいて、ユーザー画面内にポップアップを通知
    -   データベースエラー・予約情報のエラー
        -   ユーザーに画面内の通知機能でその旨を通知し、すべてのユーザー機能（チェックインも含む）を停止。
    -   QRコードの不具合
        -   ユーザーに画面内の通知機能でその旨を通知
        -   QRコードが生成できない場合には、整理番号をバーコード表示（API利用）
        -   それでも無理なら手入力
    -   サーバーダウン
    -   ログインできない
        -   Gmail APIシステムが導入できれば、ログインなしでメールアドレスを入力できるようにして、そのメールアドレスにQRコードを送信。
    -   チェックイン端末の故障
        -   代替え機を用意（事前にアプリをダウンロード）
-   XSS対策
-   バリデーションルール
-   WAF導入
-   IP制限：実現可能性は低い
-   レートリミット
-   SQLインジェクション
-   データ削除：忘れ物等の確認を想定して、1週間程度は保存するか検討

## 5. 操作フロー

### 予約したユーザー

-   **予約**
1.  ユーザーは、スマートフォンまたはPCから予約用ユーザーサイトにアクセスし、ログインを行う
2.  「新規予約」を選択
     -   既に予約がある場合は、その予約情報とQRコードが表示（新たな新規予約はできない）
3.  利用人数、希望日時、滞在予定時間等の予約情報を入力
    -   システム設定で座席指定が可能な場合は、座席も選択
    -   座席は、その時点でのデータをリアルタイムで反映
    -   座席を選択した時点で仮予約状態となる
4.  入力内容を確認画面で確認
    -   必要であれば入力画面に戻り修正（入力内容は保持される）
5.  「確定」ボタンを押す
6.  ユーザーに予約完了を通知。同時に、予約情報とチェックイン時に使用するQRコードをサイト内に表示
-   **予約の変更**
1.  ユーザーは、予約用ユーザーサイトにログイン後
2.  「予約変更」機能を選択
3.  予約番号やメールアドレス等で該当の予約を呼び出す
4.  変更の場合は、呼び出された予約情報が表示された画面で、希望する内容に変更
5.  変更内容を確認画面で確認後、「確定」ボタンを押す
6.  変更後の予約情報とQRコードが画面に更新表示され、画面内でも通知
-   **予約のキャンセル**
1.  ユーザーは、予約用ユーザーサイトにログイン後
2.  「キャンセル」機能を選択
3.  「キャンセル実行」ボタンを押し、確認画面を経て手続きを完了
     -   予約情報やQRコードは削除され、データベース内のデータも更新
     -   キャンセル完了の通知を送信（※サーバーがメール送信不可のため、画面通知のみ）
-   **チェックイン**
1.  ユーザーは、大学生協の入口で、設置されているチェックイン画面（PC端末等）を操作
2.  「予約している」ボタンを選択
3.  事前に予約用ユーザーサイトのログイン後画面に表示されたQRコードを、端末のカメラ（インカメラ等）で読み取らせる
4.  チェックイン完了

### 予約していないユーザー

-   **チェックイン**
1.  ユーザーは、大学生協の入口で、設置されているチェックイン画面（PC端末等）を操作
2.  「予約していない」ボタンを選択
3.  必要情報を入力
4.  入力内容を確認画面で確認し、必要であれば修正（入力内容は保持される）
5.  画面に自身の入力情報が自動で表示されるので確認（システムが許容する範囲で変更も可能に）
6.  「確定」ボタンを押す
7.  割り当てられた座席位置を画面に表示

### 管理者

-   **予約状況の確認・管理**
1.  管理者は、管理者サイトにアクセスし、専用のIDとパスワードでログイン
2.  必要な項目を選択
3.  設定や操作を行う

## 6. アップデート機能の候補（メモ）：将来、アップデート・拡張する機能の候補

### キャンセル待ち

-   **新たに導入する必要のあるシステム**
    -   キャンセル待ち登録用ユーザーサイト（スマートフォン・PC対応）
    -   キャンセル待ち確定用ユーザーサイト（スマートフォン・PC対応）
-   **キャンセル待ち機能**
    -   **キャンセル待ち登録機能**
        -   希望日時が満席の場合、キャンセル待ち用のメールアドレス等を入力して登録
    -   **空き発生時URL送信機能**
        -   キャンセル等で空きが発生した場合、何らかの方法で通知（※メール送信不可のため、画面上の通知や代替手段を検討）
    -   **予約情報確認・変更機能**
        -   送信されたURLからアクセスし、予約情報を確認、必要であれば変更
    -   **キャンセル待ちからの予約確定機能**
        -   確認画面を経て予約を確定
    -   **自動キャンセル機能**
        -   規定時間以内に予約が確定されない場合や、希望日時を過ぎた場合には自動的にキャンセル待ち登録を無効化し、その旨を通知
            （※メール送信不可のため、代替手段を検討）
-   **流れ（ログインなしの場合）**
    ※ユーザーがサイトで希望日時等の予約を試みるが、該当の席が埋まっている場合
1.  画面内で「キャンセル待ち登録」機能を選択
    -   サイト内やチェックイン画面からしか飛べない
2.  キャンセル通知を受け取るメールアドレス等を入力し登録
3.  希望条件に合致するキャンセルが発生した場合、システムは登録されたメールアドレス宛に、予約手続き用の個別URLを自動送信
    （※メール送信不可のため、代替手段を検討）
4.  ユーザーは、メール内のURLをクリックし、キャンセル待ち確定用ユーザーサイトにアクセス（※上記に伴い変更）
5.  表示された予約情報（事前入力されている情報）を確認し、必要であれば変更
6.  確認画面を経て「予約確定」ボタンを押す（規定時間内に操作が必要）。
7.  システムは予約を確定し、予約情報とチェックイン用QRコードを画面に表示し、メールでも自動送信（※メール送信不可のため、画面表示のみ）

### GmailのAPI

-   アプリ内でログインして通知をするとなると、ユーザーが見ない可能性があるので、通知をメールで送信する
-   補足：現システムのIDとパスワードは、メールによる予約管理を行うことができれば、必要なくなる
    -   実現可能性が不明なので、とりあえずはログインの仕組みを作り、余裕があればGmail等のAPIを使った仕組みを考える
    -   予約情報内にメールアドレスを入力する
    -   セキュリティ上でもメールアドレス以外の個人情報を入力する必要がなくなる
    -   メールアドレスが存在するかの確認や、不正なメールアドレスが使用されていないかの確認が必要
        -   不正利用については、自身のメールアドレスに予約情報・QRコードが届くので、キャンセルすれば問題はない        

### NFCタグによる座席案内機能

1.  チェックイン端末で、予約済みか予約していないかを選択すると同時に、データベースに新たなレコード枠（チェックイン情報）を追加
2.  リアルタイムで最新のレコードを専用サイト（非公開）に表示
3.  チェックイン端末付近に設置されたNFCタグから、スマートフォンで静的URLを読み取る
    -   URL内に、そのURLの後ろに追加するための文字列（専用サイトの情報から作成）を埋め込み、動的に座席案内用URLを生成して自動で移動
4.  新たな座席案内用URL内で、URL後部の文字列情報をもとに、個別の座席への案内図や座席情報を表示
-   Webサイト内での提示と比べタッチで済むため、画面の操作の必要がない

![NFCタグによる座席案内機能](NFC_guid.png)

### 混雑状況

-   **表示位置**
    -   新規予約・予約変更・キャンセル機能と同じ予約用ユーザーサイト画面の上の方
-   **表示方法**
    -   混雑状況を棒グラフ等で視覚的に表示する。（参考: Google Map のような時間帯別混雑表示）
    -   表示粒度: 曜日ごとではなく、利用人数ごとの混雑状況表示を検討
-   **実装方法（案）**
    -   座席管理用データベースの情報をリアルタイムに集計し、人数ごと・1時間ごとの混雑具合を示すデータベースを（仮想的に）作成
    -   混雑状況用データベースの情報をもとに、棒グラフなどの形式でWeb上に表示
![混雑状況](Google_Map_congestion.png)

### メニューバー（ユーザー画面）

-   現在のユーザー画面は、単一ページ構成に近い。
    -   より多くの機能へのアクセスを提供するため、メニューバーの導入を検討（参考: マクドナルドHPなどのメニューバー構成）
![メニューバー](Menu_Bar.png)
-   **メニューバーの内容候補**:
    -   **予約関連**
        -   新規予約
        -   予約変更・キャンセル
    -   **混雑状況・予想**
        -   現在の座席混雑状況
        -   今後の混雑予想
    -   **空席検索**
        -   その日の空席状況（座席混雑度マップ表示、10分ごと）
    -   **メニュー情報**
        -   今日のメニュー一覧表示（参考: マクドナルド公式メニュー）
    -   **店舗情報**
        -   営業時間・大学開講状況（・大学授業数）
            -   混雑予想にも利用
        -   大学MAP（既存のものを利用）
    -   **言語設定**: 日本語/英語 切り替え
-   **機能詳細**
    -   **混雑状況・予想**
        -   **現在の混雑状況**：予約画面上部と同様の人数別グラフを表示。
        -   **今後の混雑予想**:
            -   大学の授業カレンダー等と連携し、予約数や過去の利用データも加味して予測
            -   曜日、講義数、時間帯、過去の座席利用状況などを基に算出
            -   **新たに必要なデータベース**
                -   大学の授業日カレンダー
                -   大学の曜日ごとの講義数・講義教室・受講者数（管理者サイトでの変更）
                -   過去の座席利用状況（曜日ごと・人数ごと）
    -   **空席検索**
        -   **その日の空席状況**: 座席混雑度マップ形式で表示（10分ごとの更新）。
    -   **メニュー情報**
        -   大学生協などの今日のメニュー一覧（写真、値段、カロリー、名前等も）
        -   **更新方法**: 管理者が管理画面の選択リスト（selectタグ等）で毎日更新できる仕組み
        -   **新たに必要なデータベース**
            -   メニュー一覧データベース（商品名、価格、画像パス、カロリー等）
